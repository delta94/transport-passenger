create or replace FUNCTION INSERT_BUS(ID1 IN BUSES.ID%TYPE, BUS_TYPE_ID1 IN BUSES.BUS_TYPE_ID%TYPE, REGISTRATION1 IN BUSES.REGISTRATION%TYPE, PRICE1 IN BUSES.PRICE%TYPE, 
STATUS1 IN BUSES.STATUS%TYPE, MILES1 IN BUSES.MILES%TYPE,WARRANTY_MONTH1 IN BUSES.WARRANTY_MONTH%TYPE, WARRANTY_MILES1 IN BUSES.WARRANTY_MILES%TYPE
, DESCRIPTION1 IN BUSES.DESCRIPTION%TYPE,CREATED_AT1 IN TIMESTAMP with time zone, UPDATED_AT1 IN TIMESTAMP with time zone)
RETURNS integer 
AS $$
DECLARE  
ROW_COUNT INTEGER := 0;
v_result varchar(250);
BEGIN
    SELECT COUNT(*) INTO ROW_COUNT FROM BUSES WHERE ID = ID1;
    IF ROW_COUNT  > 0 THEN
		select show_message('Duplicate of ID !') into v_result;
        RETURN 1;
    ELSE
        SELECT COUNT(*) INTO ROW_COUNT FROM BUSES WHERE REGISTRATION = REGISTRATION1;
        IF ROW_COUNT  > 0 THEN
			select show_message('Duplicate of REGISTRATION !') into v_result;
            RETURN 2;
        END IF;
        SELECT COUNT(*) INTO ROW_COUNT FROM BUS_TYPES WHERE ID = BUS_TYPE_ID1;
        IF ROW_COUNT = 0 THEN
			select show_message('BUS_TYPE_ID does not exist !') into v_result;
            RETURN 3;
        ELSE
            INSERT INTO BUSES VALUES (ID1,BUS_TYPE_ID1,REGISTRATION1,PRICE1,STATUS1,MILES1,WARRANTY_MONTH1,WARRANTY_MILES1,DESCRIPTION1,CREATED_AT1,UPDATED_AT1);
            select show_message('Inserting BUSES is successful !') into v_result;
        END IF;
    END IF;
	RETURN 0;
END;
$$ language plpgsql;