create or replace FUNCTION UPDATE_TRIP_DAILY(ID1 IN TRIP_DAILIES.ID%TYPE , NAME1 IN TRIP_DAILIES.NAME%TYPE, DEPART_STATION_ID1 IN TRIP_DAILIES.DEPART_STATION_ID%TYPE,ARRIVE_STATION_ID1 IN 
 TRIP_DAILIES.ARRIVE_STATION_ID%TYPE , DEPART_TIME1 IN  TRIP_DAILIES.DEPART_TIME%TYPE, ARRIVE_TIME1 IN TRIP_DAILIES.ARRIVE_TIME%TYPE,
DURATION1 IN  TRIP_DAILIES.DURATION%TYPE, PRICE1 IN TRIP_DAILIES.PRICE%TYPE, DISTANCE1 IN TRIP_DAILIES.DISTANCE%TYPE, HOTLINE1 IN TRIP_DAILIES.HOTLINE%TYPE
, BUS_TYPE_ID1 IN TRIP_DAILIES.BUS_TYPE_ID%TYPE) 
RETURNS INTEGER 
AS $$
DECLARE
    ROW_COUNT INTEGER := 0;
    ROW_TRIP_DAILY TRIP_DAILIES%ROWTYPE;
	v_result varchar(250);
BEGIN
    SELECT COUNT(*) INTO ROW_COUNT FROM TRIP_DAILIES WHERE ID = ID1;
    IF ROW_COUNT = 0 THEN
		select show_message('ID DOES NOT EXIST !') into v_result;
        RETURN 1;
    ELSE
        SELECT * INTO ROW_TRIP_DAILY FROM TRIP_DAILIES WHERE ID = ID1;
        
        IF NAME1 IS NULL THEN
            NAME1 := ROW_TRIP_DAILY.NAME;
        END IF;
        
        IF DEPART_STATION_ID1 IS NULL THEN
            DEPART_STATION_ID1 := ROW_TRIP_DAILY.DEPART_STATION_ID;
        ELSE
            SELECT COUNT(*) INTO ROW_COUNT FROM BUS_STATIONS WHERE ID = DEPART_STATION_ID1;
            IF ROW_COUNT = 0 THEN
				select show_message('DEPART_STATION_ID DOES NOT EXIST !') into v_result;
                RETURN 2;
            END IF;
        END IF;
        
        IF ARRIVE_STATION_ID1 IS NULL THEN
            ARRIVE_STATION_ID1 := ROW_TRIP_DAILY.ARRIVE_STATION_ID;
        ELSE 
             SELECT COUNT(*) INTO ROW_COUNT FROM BUS_STATIONS WHERE ID = ARRIVE_STATION_ID1;
            IF ROW_COUNT = 0 THEN
				select show_message('ARRIVE_STATION_ID DOES NOT EXIST !') into v_result;
                RETURN 3;
            END IF;
        END IF;
        
        IF DEPART_TIME1 IS NULL THEN
            DEPART_TIME1 := ROW_TRIP_DAILY.DEPART_TIME;
        END IF;
        
        IF ARRIVE_TIME1 IS NULL THEN
            ARRIVE_TIME1 := ROW_TRIP_DAILY.ARRIVE_TIME;
        END IF;
        
        IF DURATION1 IS NULL THEN
            DURATION1 := ROW_TRIP_DAILY.DURATION;
        END IF;
        
        IF PRICE1 IS NULL THEN
            PRICE1 := ROW_TRIP_DAILY.PRICE;
        END IF;
        
        IF DISTANCE1 IS NULL THEN
            DISTANCE1 := ROW_TRIP_DAILY.DISTANCE;
        END IF;
        
        IF HOTLINE1 IS NULL THEN
            HOTLINE1 := ROW_TRIP_DAILY.HOTLINE;
        END IF;
        
        IF BUS_TYPE_ID1 IS NULL THEN
            BUS_TYPE_ID1 := ROW_TRIP_DAILY.BUS_TYPE_ID;
        ELSE
            SELECT COUNT(*) INTO ROW_COUNT FROM BUS_TYPES WHERE ID = BUS_TYPE_ID1;
            IF ROW_COUNT = 0 THEN
				select show_message('BUS_TYPE_ID DOES NOT EXIST !') into v_result;
                RETURN 4;
            END IF;
        END IF;
        
        UPDATE TRIP_DAILIES SET NAME = NAME1, DEPART_STATION_ID = DEPART_STATION_ID1, ARRIVE_STATION_ID = ARRIVE_STATION_ID1,
        DEPART_TIME = DEPART_TIME1, ARRIVE_TIME = ARRIVE_TIME1 ,DURATION = DURATION1,
        PRICE = PRICE1, DISTANCE = DISTANCE1, HOTLINE = HOTLINE1, BUS_TYPE_ID = BUS_TYPE_ID1, CREATED_AT = CREATED_AT, UPDATED_AT = CURRENT_TIMESTAMP  
		WHERE ID = ID1;
        select show_message('UPDATING TRIP_DAILIES IS SUCCESSFUL !') into v_result;
        
    END IF;
    RETURN 0;
END ;
$$ language plpgsql;