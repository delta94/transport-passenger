create or replace FUNCTION UPDATE_TRANSACTION(ID1 IN TRANSACTIONS.ID%TYPE, CODE1 IN  TRANSACTIONS.CODE%TYPE, TIMESTAMP1 IN  TRANSACTIONS.TIMESTAMP%TYPE, 
CUSTOMER_ID1 IN  TRANSACTIONS.CUSTOMER_ID%TYPE,SELLER_ID1 IN  TRANSACTIONS.SELLER_ID%TYPE, 
TOTAL_PRICE1 IN  TRANSACTIONS.TOTAL_PRICE%TYPE, PAYMENT_METHOD1 IN TRANSACTIONS.PAYMENT_METHOD%TYPE, STATUS1 IN  TRANSACTIONS.STATUS%TYPE)
RETURNS INTEGER 
AS $$
DECLARE
    ROW_COUNT INTEGER := 0;
    ROW_TRANSACTION TRANSACTIONS%ROWTYPE;
	v_result varchar(250);
BEGIN
    SELECT COUNT(*) INTO ROW_COUNT FROM TRANSACTIONS WHERE ID = ID1;
    IF ROW_COUNT = 0 THEN
		select show_message('ID DOES NOT EXIST !') into v_result;
        RETURN 1;
    ELSE
        SELECT * INTO ROW_TRANSACTION FROM TRANSACTIONS WHERE ID = ID1;
        
        IF CODE1 IS NULL THEN 
            CODE1 := ROW_TRANSACTION.CODE;
        END IF;
        
        IF TIMESTAMP1 IS NULL THEN 
            TIMESTAMP1 := ROW_TRANSACTION.TIMESTAMP;
        END IF;
        
        IF CUSTOMER_ID1 IS NULL THEN 
            CUSTOMER_ID1 := ROW_TRANSACTION.CUSTOMER_ID;
        ELSE
            SELECT COUNT(*) INTO ROW_COUNT FROM CUSTOMERS WHERE ID = CUSTOMER_ID1;
            IF ROW_COUNT = 0 THEN
				select show_message('CUSTOMER_ID DOES NOT EXIST !') into v_result;
                RETURN 2;
            END IF;
        END IF;
        
        IF SELLER_ID1 IS NULL THEN 
            SELLER_ID1 := ROW_TRANSACTION.SELLER_ID;
        ELSE
            SELECT COUNT(*) INTO ROW_COUNT FROM SELLERS WHERE ID = SELLER_ID1;
            IF ROW_COUNT = 0 THEN
				select show_message('SELLER_ID DOES NOT EXIST !') into v_result;
                RETURN 3;
            END IF;
        END IF;
        
        IF TOTAL_PRICE1 IS NULL THEN 
            TOTAL_PRICE1 := ROW_TRANSACTION.TOTAL_PRICE;
        END IF;
        
        IF PAYMENT_METHOD1 IS NULL THEN 
            PAYMENT_METHOD1 := ROW_TRANSACTION.PAYMENT_METHOD;
        END IF;
        
        IF STATUS1 IS NULL THEN 
            STATUS1 := ROW_TRANSACTION.STATUS;
        END IF;
        
        UPDATE TRANSACTIONS SET CODE = CODE1 , TIMESTAMP =  TIMESTAMP1, CUSTOMER_ID = CUSTOMER_ID1, SELLER_ID = SELLER_ID1,
        TOTAL_PRICE = TOTAL_PRICE1, PAYMENT_METHOD = PAYMENT_METHOD1, STATUS = STATUS1, CREATED_AT = CREATED_AT, UPDATED_AT = CURRENT_TIMESTAMP 
		WHERE ID = ID1;
       	select show_message('UPDATING TRANSACTIONS IS SUCCESSFUL !') into v_result;
        
        
    END IF;
    RETURN 0;
END ;
$$ language plpgsql;