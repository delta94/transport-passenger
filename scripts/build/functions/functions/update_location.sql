create or replace FUNCTION UPDATE_LOCATION(ID1 IN LOCATIONS.ID%TYPE, NAME1 IN  LOCATIONS.NAME%TYPE, ADDRESS1 IN  LOCATIONS.ADDRESS%TYPE, LATITUDE1 IN  LOCATIONS.LATITUDE%TYPE
, LONGITUDE1 IN  LOCATIONS.LONGITUDE%TYPE, OPEN_TIME1 IN  LOCATIONS.OPEN_TIME%TYPE, CLOSE_TIME1 IN  LOCATIONS.CLOSE_TIME%TYPE, TEL1 IN  LOCATIONS.TEL%TYPE, DISTRICT_ID1 
IN  LOCATIONS.DISTRICT_ID%TYPE,TYPE1 IN  LOCATIONS.TYPE%TYPE) 
RETURNS INTEGER 
AS $$
DECLARE
    ROW_COUNT INTEGER := 0;
    ROW_LOCATION LOCATIONS%ROWTYPE;
	v_result varchar(250);
BEGIN
    SELECT COUNT(*) INTO ROW_COUNT FROM LOCATIONS WHERE ID = ID1;
    IF ROW_COUNT = 0 THEN
		select show_message('ID DOES NOT EXIST !') into v_result;
        RETURN 1;
    ELSE
        SELECT * INTO ROW_LOCATION FROM LOCATIONS WHERE ID = ID1;
        
        IF NAME1 IS NULL THEN
            NAME1 := ROW_LOCATION.NAME;
        END IF;
        
        IF ADDRESS1 IS NULL THEN
            ADDRESS1 := ROW_LOCATION.ADDRESS;
        END IF;
        
        IF LATITUDE1 IS NULL THEN
            LATITUDE1 := ROW_LOCATION.LATITUDE;
        END IF;
        
        IF LONGITUDE1 IS NULL THEN
            LONGITUDE1 := ROW_LOCATION.LONGITUDE;
        END IF;
        
        IF OPEN_TIME1 IS NULL THEN
            OPEN_TIME1 := ROW_LOCATION.OPEN_TIME;
        END IF;
        
        IF CLOSE_TIME1 IS NULL THEN
            CLOSE_TIME1 := ROW_LOCATION.CLOSE_TIME;
        END IF;
        
        IF TEL1 IS NULL THEN
            TEL1 := ROW_LOCATION.TEL;
        END IF;
        
        IF DISTRICT_ID1 IS NULL THEN
            DISTRICT_ID1 := ROW_LOCATION.DISTRICT_ID;
        ELSE 
            SELECT COUNT(*) INTO ROW_COUNT FROM DISTRICTS WHERE ID = DISTRICT_ID1;
            IF ROW_COUNT = 0  THEN
				select show_message('DISTRICT_ID DOES NOT EXIST !') into v_result;
                RETURN 2;
            END IF;
        END IF;
        
        IF TYPE1 IS NULL THEN
            TYPE1 := ROW_LOCATION.TYPE;
        END IF;
        UPDATE LOCATIONS SET NAME = NAME1, ADDRESS = ADDRESS1, LATITUDE = LATITUDE1, LONGITUDE = LONGITUDE1, OPEN_TIME = OPEN_TIME1, CLOSE_TIME = CLOSE_TIME1, TEL = TEL1,
        DISTRICT_ID = DISTRICT_ID1, TYPE = TYPE1, CREATED_AT = CREATED_AT, UPDATED_AT = CURRENT_TIMESTAMP 
        WHERE ID = ID1;
     	select show_message('UPDATING LOCATIONS IS SUCCESSFUL !') into v_result;
    END IF;
    RETURN 0;
END ;
$$ language plpgsql;